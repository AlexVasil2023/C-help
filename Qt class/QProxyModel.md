# Промежуточные модели

Как вы уже знаете, одну модель можно установить в нескольких представлениях. При этом изменение порядка следования элементов в одном представлении повлечет за собой изменение порядка следования элементов в другом представлении. Чтобы предотвратить изменение порядка следования элементов в базовой модели, следует создать промежуточную модель с помощью класса `QSortFilterProxyModel` и установить ее в представлении. Иерархия наследования для класса `QSortFilterProxyModel` выглядит так:
```
QObject — QAbstractItemModel — QAbstractProxyModel — QSortFilterProxyModel
```

Формат конструктора класса `QSortFilterProxyModel`:
```c++
#include <QSortFilterProxyModel>

QSortFilterProxyModel(QObject *parent = nullptr)
```

Класс `QSortFilterProxyModel` наследует следующие методы из класса `QAbstractProxyModel` (перечислены только основные методы; полный список смотрите в документации):
> **setSourceModel()** — устанавливает базовую модель. Прототип метода:
```c++
virtual void setSourceModel(QAbstractItemModel *sourceModel)
```

> **sourceModel()** — возвращает указатель на базовую модель. Прототип метода:
```c++
QAbstractItemModel *sourceModel() const
```

Класс `QSortFilterProxyModel` поддерживает основные методы обычных моделей и дополнительно содержит следующие методы (перечислены только основные методы; полный список смотрите в документации):

> **sort()** — производит сортировку. Прототип метода:
```c++
virtual void sort(int column, Qt::SortOrder order = Qt::AscendingOrder)
```

Если во втором параметре указана константа `Qt::AscendingOrder`, то сортировка производится в прямом порядке, а если `Qt::DescendingOrder`, то в обратном. Если в параметре `column` указать значение `–1`, то будет использован порядок следования элементов из базовой модели.

Чтобы включить сортировку столбцов пользователем, следует передать значение `true` в метод `setSortingEnabled()` объекта представления. 

> **setSortRole()** — задает [[Roles Element|роль]], по которой производится сортировка. По умолчанию сортировка производится по роли `DisplayRole`. Прототип метода:
```c++
void setSortRole(int role)
```

> **setSortCaseSensitivity()** — если в качестве параметра указать константу `Qt::CaseInsensitive`, то при сортировке не будет учитываться регистр символов, а если `Qt::CaseSensitive`, то регистр будет учитываться. Прототип метода:
```c++
void setSortCaseSensitivity(Qt::CaseSensitivity)
```

> **setSortLocaleAware()** — если в качестве параметра указать значение `true`, то при сортировке будут учитываться настройки локали. Прототип метода:
```c++
void setSortLocaleAware(bool)
```

> **setFilterFixedString()** — в результат попадут только строки, которые содержат заданный фрагмент. Если указать пустую строку, то в результат попадут все строки из базовой модели. Метод является слотом. Прототип метода:
```c++
void setFilterFixedString(const QString &pattern)
```

> **setFilterRegularExpression()** — производит фильтрацию элементов в соответствии с указанным регулярным выражением. Если указать пустую строку, то в результат попадут все строки из базовой модели. Метод является слотом. Прототипы метода:
```c++
void setFilterRegularExpression(const QRegularExpression &regularExpression)
void setFilterRegularExpression(const QString &pattern)
```

> **setFilterWildcard()** — производит фильтрацию элементов в соответствии с указанной строкой, содержащей подстановочные знаки:

* `?` — один любой символ;
* `*` — нуль или более любых символов;
* `[...]` — диапазон значений.

Остальные символы трактуются как есть. Если в качестве параметра указать пустую строку, то в результат попадут все строки из базовой модели. Метод является слотом. Прототип метода:
```c++
void setFilterWildcard(const QString &pattern)
```

> **setFilterKeyColumn()** — задает индекс столбца, по которому будет производиться фильтрация. Если в качестве параметра указать значение `–1`, то будут просматриваться элементы во всех столбцах. По умолчанию фильтрация производится по первому столбцу. Прототип метода:
```c++
void setFilterKeyColumn(int column)
```

> **setFilterRole()** — задает [[Roles Element|роль]], по которой производится фильтрация. По умолчанию сортировка производится по роли `DisplayRole`. Прототип метода:
```c++
void setFilterRole(int role)
```

> **setFilterCaseSensitivity()** — если в качестве параметра указать константу `Qt::CaseInsensitive`, то при фильтрации не будет учитываться регистр символов, а если `Qt::CaseSensitive`, то регистр будет учитываться. Прототип метода:
```c++
void setFilterCaseSensitivity(Qt::CaseSensitivity)
```

> `setDynamicSortFilter()` — если в качестве параметра указано значение `true`, то при изменении базовой модели будет производиться повторная сортировка или фильтрация. Прототип метода:
```c++
void setDynamicSortFilter(bool enable)
```





