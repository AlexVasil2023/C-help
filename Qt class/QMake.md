# QMake

**QMake** - это инструмент, который считывает файл проекта и генерирует файл сборки. Файл проекта - это упрощенная запись конфигурации вашего проекта, внешние зависимости, а также ваши исходные файлы. Самый простой файл проекта, вероятно, выглядит так:

```js
// myproject.pro
SOURCES += main.cpp
```

Здесь мы собираем исполняемое приложение, которое будет иметь имя `myproject`, основанное на имени файла проекта. Сборка будет содержать только исходный файл `main.cpp`. И по умолчанию для этого проекта мы будем использовать модуль `QtCore` и `QtGui` . Если бы наш проект был QML-приложением, то мы необходимо добавить в список модули `QtQuick` и `QtQml`:

```js
// myproject.pro
QT += qml quick

SOURCES += main.cpp
```

Теперь файл сборки знает, что нужно связать с модулями `QtQml` и `QtQuick` Qt. `QMake` использует понятия = , += и -= для назначения, добавления, удаления элементов из списка опций соответственно. Для чисто консольной сборки без зависимостей от
пользовательского интерфейса необходимо удалить модуль QtGui:

```js
// myproject.pro
QT -= gui
SOURCES += main.cpp
```

Если требуется собрать не приложение, а библиотеку, необходимо изменить шаблон сборки:

```js
// myproject.pro
TEMPLATE = lib

QT -= gui

HEADERS += utils.h
SOURCES += utils.cpp
```

Теперь проект будет собираться как библиотека без зависимостей от пользовательского интерфейса с использованием заголовка `utils.h` и исходного файла `utils.cpp`. Формат библиотеки будет зависеть от ОС, на которой вы собираете проект.

Часто возникают более сложные ситуации, когда необходимо собрать набор проектов. Для этого `qmake` предлагает шаблон `subdirs`. Предположим, что у нас есть проект `mylib` и проект `myapp`. Тогда наша установка может выглядеть следующим образом:

```js
my.pro

mylib/mylib.pro
mylib/utils.h
mylib/utils.cpp
myapp/myapp.pro
myapp/main.cpp
```

Мы уже знаем, как будут выглядеть `mylib.pro` и `myapp.pro`. Файл `my.pro` как общий файл проекта будет выглядеть следующим образом:

```js
// my.pro TEMPLATE
= subdirs

subdirs = mylib \
myapp

myapp.depends = mylib
```

Здесь объявляется проект с двумя подпроектами: `mylib` и `myapp`, где `myapp` зависит от `mylib` . При запуске `qmake` на этом файле проекта будет сгенерирован файл сборки для каждого проекта в соответствующей папке. При запуске `makefile` для `my.pro` все подпроекты также будут собраны.

Иногда требуется сделать одно на одной платформе и другое на других платформах в зависимости от конфигурации. Для этого в `qmake` введено понятие диапазонов. Область применяется, когда опция конфигурации установлена в `true`.

Например, для использования специфической для `Unix` реализации `utils` можно использовать:

```js
unix {
	SOURCES += utils_unix.cpp
} else {
	SOURCES += utils.cpp
}
```

В нем говорится, что если переменная `CONFIG` содержит опцию `Unix`, то следует применить эту область, в противном случае используется другой путь. Типичный пример - удаление обвязки приложений под `mac`:

```js
macx {
	CONFIG -= app_bundle
}
```

В результате приложение будет создано как обычный исполняемый файл под `mac`, а не как папка `.app`, которая используется при установке приложений.

Проекты на основе `QMake` обычно являются выбором номер один, когда вы начинаете программировать Qt-приложения. Существуют и другие варианты. Все они имеют свои преимущества и недостатки. Эти варианты мы рассмотрим далее.












