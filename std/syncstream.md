
[[#syncstream|syncstream]] 11.7.5(STL)
1. [[#osyncstream|osyncstream]]



# syncstream

В многопоточной системе ввод-вывод становится ненадежным и беспорядочным, если
не:
>
> Только один [[thread#Базовые потоки класс std thread|thread]] использует [[stream|stream]].
> 
> Доступ к [[stream|stream]] синхронизируется таким образом, что одновременно доступ получает только один [[thread|thread]].

[[#osyncstream|osyncstream]] гарантирует, что последовательность операций вывода будет завершена и их результаты будут такими, как ожидалось, в выходном буфере, даже если какой-либо другой [[thread|thread]] попытается выполнить запись. Например:
```c++
void unsafe(int x, string& s)
{
	cout << x;
	cout << s;
}
```

Другой [[thread|thread]] может вызвать состояние гонки ( #§18_2) и привести к неожиданному результату. Чтобы избежать этого, можно использовать [[#osyncstream|osyncstream]]
```c++
void safer(int x, string& s)
{
	osyncstream oss(cout);
	oss << x;
	oss << s;
}
```

Другие [[thread|thread]], которые также используют [[#osyncstream|osyncstream]], не будут вмешиваться. Другой [[thread|thread]], который напрямую использует [[cout|cout]], может создавать помехи, поэтому либо используйте [[#osyncstream|ostringstream]] повсеместно, либо убедитесь, что только один [[thread|thread]] выдает выходные данные в определенный выходной поток.

Параллелизм может быть сложным, поэтому будьте осторожны ( #глава_18). Избегайте совместного использования данных между [[thread|thread]]ами, когда это возможно.

## osyncstream
#osyncstream








