
[[#Язык для написания ядер|Язык для написания ядер]] 8
1. [[#Встроенные скалярные типы данных|Встроенные скалярные типы данных]] 8.1

# Язык для написания ядер

Исполняемые на OpenCL-устройствах ядра пишутся на языке программирования `OpenCL C` (OpenCL C Programming Language), который основывается на спецификации языка C 1999 года (т.н. C99) со специфическими расширениями и ограничениями. Расширения включают новые типы данных (в том числе векторные), ключевые слова, дополнительные квалификаторы, а также набор функций (математические, геометрические, отношения, чтения/записи для векторов и др.). Ограничения касаются: работы с указателями (из-за наличия разных адресных пространств), отсутствия возможности работать с битовыми полями, массивами переменной длины, рекурсией и спецификаторами класса хранения (`extern`, `static`, `auto`, `register`). Также недоступны предопределённые идентификаторы и ставшие привычными стандартные заголовочные файлы а, стало быть, и объявляемые в них функции.

Излагаемое далее соответствует спецификации `OpenCL 1.1` (если явно не указано иное), поскольку именно эта версия доступна для экспериментов в дисплейном классе 5-42.

# Встроенные скалярные типы данных

Список встроенных типов скалярных данных содержит как привычные в рамках C типы (`bool`, `char`, `unsigned char`, `short`, `unsigned short`, `int`, `unsigned int`, `long`, `unsigned long`, `float`, `void`), так и «сокращённые» варианты для беззнаковых типов (`uchar`, `ushort`, `uint`, `ulong`), а также дополнительно: `half` («облегчённый» вариант вещественных значений, занимающий 16 бит), `size_t` (целое без знака для результата операции `sizeof`), `ptrdiff_t` (целое со знаком для результата вычитания двух указателей), `intptr_t` (тип целое со знаком, такой, что указатель на `void` может быть преобразован к нему и обратно без изменений в значении указателя), `uintptr_t` (тип целое без знака, аналогичный по свойствам предыдущему). Все типы с суффиксом `_t` в именах имеют размер, определяемый значением свойства `CL_DEVICE_ADDRESS_BITS` у конкретного OpenCL-устройства (32 бита или 64 бита).

Использование в коде ядер синонимов для беззнаковых типов, вероятно, объясняется тем, что для подобных имён типов из одного слова легко образовать векторные варианты этих типов: `uint2`, `uint3`, `uint4`, `uint8`, `uint16`, — аналогично `float2`, `float3`, `float4` и т.д.

Большая часть встроенных скалярных типов имеет аналоги, определённые в заголовочных файлах `OpenCL` и используемые в качестве параметров функций API : `cl_char`, `cl_uchar`, `cl_short`, `cl_ushort`, `cl_int`, `cl_uint`, `cl_long`, `cl_ulong`, `cl_float`, `cl_half`.

Тип данных `half` должен соответствовать стандарту IEEE 754-2008. Числа этого типа используют один знаковый бит, 5 бит экспоненты и 10 бит мантиссы. Смещение экспоненты равно 1. В этом типе данных могут быть представлены обычные вещественные числа, а также денормализованные числа, бесконечности и не-числа (`NaN`).

Тип данных half может быть использован только для объявления указателя на буфер с такими величинами. Загрузка и выгрузка этих величин по указателю должна выполняться с использованием функций `vload_half`, `vload_halfn` , `vloada_halfn` и `vstore_half`, `vstore_halfn` , `vstorea_halfn` (здесь `n` обозначает одно из чисел 2,3,4,8,16).

Следует отметить, что тип `half (halfn)` определён только тогда, когда поддерживается расширение `cl_khr_fp16` (подробности излагаются далее).






















