
[[#Отладка шаблонов|Отладка шаблонов]] 28
1. [[#Поверхностное инстанцирование|Поверхностное инстанцирование]] 28.1





# Отладка шаблонов

Когда дело доходит до отладки шаблонов, возникают два класса проблем. Первый класс проблем — проблемы авторов шаблонов: как можно гарантировать, что написанные шаблоны будут функционировать для любых аргументов шаблонов, удовлетворяющих задокументированным автором условиям? Второй класс проблем по сути обратный: как пользователь шаблона может узнать, какие требования к параметрам шаблона он нарушил, когда шаблон ведет себя не так, как документировано?

Прежде чем приступить к серьезному обсуждению этих вопросов, полезно рассмотреть виды ограничений, которые могут быть наложены на параметры шаблона. В этой главе мы в основном имеем дело с ограничениями, которые при нарушении приводят к ошибкам компиляции, и называем эти ограничения синтаксическими ограничениями. Синтаксические ограничения могут включать необходимость наличия конструкторов определенного вида, однозначность некоторого вызова функции и так далее. Прочие виды ограничений мы называем семантическими ограничениями. Эти ограничения гораздо труднее проверить механически. В общем случае это даже может быть нецелесообразным. Например, мы можем потребовать, чтобы для типового параметра шаблона был определен оператор `<` (что является синтаксическим ограничением), но обычно мы также требуем, чтобы этот оператор фактически определял некоторое упорядочение в своей области определения (что является семантическим ограничением).

Для обозначения набора ограничений, которые многократно требуются в библиотеке шаблонов, часто используется термин концепт. Например, стандартная библиотека C++ опирается на такие [[Concepts|концепты]], как итератор с произвольным доступом или имеющий конструктор по умолчанию. С учетом данной терминологии можно сказать, что отладка кода шаблонов включает значительное количество работы по выявлению того, как в реализациях шаблонов и их использованиях нарушаются [[Concepts|концепты]]. Эта глава посвящена как проектированию, так и методам отладки, которые облегчают работу с шаблонами как для их авторов, так и для пользователей.

# Поверхностное инстанцирование

Когда происходит ошибка в шаблоне, проблема часто выявляется после длинной цепочки инстанцирований, что приводит к [[Применение шаблонов на практике#Расшифровка романов об ошибках|длинным сообщениям об ошибках]]. Для иллюстрации этого рассмотрим следующий надуманный код:






































