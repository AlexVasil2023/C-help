
[[#Шаблоны выражений|Шаблоны выражений]] 27
1. [[#Временные объекты и раздельные циклы|Временные объекты и раздельные циклы]] 27.1





# Шаблоны выражений

В этой главе описывается метод шаблонного программирования, известный под названием шаблоны выражений (`expression templates`). Впервые этот метод возник при работе с классами числовых массивов, и именно в таком контексте он рассматривается в данной главе.

Класс числовых массивов поддерживает выполнение числовых операций с массивом как с целостным объектом. Например, к двум массивам можно применить операцию сложения; в результате ее выполнения получим массив, каждый элемент которого будет суммой соответствующих элементов исходных массивов. Аналогично массив можно умножить на скаляр. Это означает, что на скаляр умножается каждый элемент исходного массива. Возникает естественное желание реализовать для массивов операторные обозначения, так знакомые нам по работе со встроенными скалярными типами:
```c++
Array<double> х(1000), у(1000);
...
х=1.2*х + х*у;
```

Для серьезных высокопроизводительных вычислительных комплексов важно, чтобы выражения такого рода вычислялись настолько эффективно, насколько можно ожидать от платформы, на которой выполняется этот код. Добиться того, чтобы такие вычисления можно было выполнять с помощью компактной записи, приведенной в рассмотренном выше примере, — задача далеко не тривиальная, однако при ее решении на помощь приходят шаблоны выражений.

Шаблоны выражений напоминают шаблонное метапрограммирование. Частично это объясняется тем, что иногда они опираются на глубоко вложенное инстанцирование шаблонов, которое не отличается от рекурсивного инстанцирования, встречающегося в шаблонном метапрограммировании. Не исключено, что на сходство этих двух методов также повлияло то, что оба они первоначально разрабатывались для [[Метапрограммирование#Гибридное метапрограммирование|поддержки высокопроизводительных операций с массивами]]. Эти два метода, несомненно, дополняют друг друга. Например, метапрограммирование удобно применять для небольших массивов фиксированного размера, а шаблоны выражений весьма эффективны для выполнения операций со средними и большими массивами, размеры которых задаются во время работы программы.

# Временные объекты и раздельные циклы

Чтобы обосновать применение шаблонов выражений, рассмотрим простейший, прямолинейный (возможно, даже наивный) подход к реализации шаблонов, позволяющих выполнять операции с числовыми массивами. Первичный шаблон массива мог бы выглядеть, как показано ниже (имя `SArray` обозначает простой массив — `simple array`).








